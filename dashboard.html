<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Earner Pro - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .glass-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }
        
        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: none;
            text-decoration: none;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-lg {
            padding: 16px 32px;
            font-size: 20px;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .earning-button {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: block;
            width: 100%;
        }
        
        .earning-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .earning-button:hover::before {
            left: 100%;
        }
        
        .earning-button:not(.disabled):not(.cooldown):hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .earning-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .earning-button.cooldown {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .earning-button.processing {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            animation: processing-pulse 1.5s infinite;
        }
        
        @keyframes processing-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -20px, 0); }
            70% { transform: translate3d(0, -10px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        @keyframes coinFlip {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
            50% { text-shadow: 0 0 30px rgba(34, 197, 94, 1), 0 0 40px rgba(34, 197, 94, 0.8); }
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1.5);
            }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399, #6ee7b7);
            border-radius: 4px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: shimmer 2s infinite;
        }
        
        .timer-progress {
            background: linear-gradient(90deg, #ef4444, #f97316, #eab308);
            transition: width 1s linear;
        }
        
        .security-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            padding: 10px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .security-safe {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.5);
        }
        
        .security-warning {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.5);
        }
        
        .security-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
            animation: danger-blink 1s infinite alternate;
        }
        
        @keyframes danger-blink {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .floating-reward {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 2.5rem;
            font-weight: bold;
            animation: floatUp 3s ease-out forwards;
        }
        
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .theme-toggle i {
            color: white;
            font-size: 20px;
        }
        
        .dark .theme-toggle i {
            color: white;
        }
        
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .notification-toast.show {
            transform: translateX(0);
        }
        
        .notification-toast.success {
            border-left: 4px solid #22c55e;
        }
        
        .notification-toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .notification-toast.warning {
            border-left: 4px solid #f59e0b;
        }
        
        .notification-toast.info {
            border-left: 4px solid #3b82f6;
        }
        
        .hidden {
            display: none !important;
        }
        
        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .coin-bounce {
            animation: coinBounce 0.6s ease-in-out;
        }
        
        @keyframes coinBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }
    </style>
</head>
<body class="gradient-bg text-white">
    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>
    
    <!-- Security Status Indicator -->
    <div class="security-indicator security-safe" id="securityStatus">
        <i class="fas fa-shield-alt"></i>
        <span>Security Active</span>
    </div>
    
    <!-- Main App Container -->
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <h1 class="text-3xl font-bold mr-2">
                    <i class="fas fa-coins text-yellow-400"></i> 
                    Coin Earner Pro
                </h1>
                <span class="text-white/80 text-lg">- Dashboard</span>
            </div>
            <div class="flex items-center space-x-4">
                <div id="userGreeting" class="text-white/80 mr-4">Welcome, User!</div>
                <button onclick="logout()" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- Status Notices -->
        <div id="guestNotice" class="glass p-4 mb-6 hidden">
            <div class="flex items-center">
                <i class="fas fa-user-clock text-yellow-400 mr-3 text-xl"></i>
                <div>
                    <h4 class="font-semibold text-yellow-400">Guest Mode</h4>
                    <p class="text-white/80 text-sm">You're browsing as a guest. Register to start earning!</p>
                </div>
            </div>
        </div>
        
        <div id="verificationNotice" class="glass p-4 mb-6 hidden">
            <div class="flex items-center">
                <i class="fas fa-envelope-open-text text-orange-400 mr-3 text-xl pulse"></i>
                <div>
                    <h4 class="font-semibold text-orange-400">Email Verification Required</h4>
                    <p class="text-white/80 text-sm">Please verify your email to start earning coins!</p>
                    <button onclick="showEmailVerification()" class="mt-2 text-xs bg-orange-500 text-white px-3 py-1 rounded-lg hover:bg-orange-600 transition-all">
                        Verify Now
                    </button>
                </div>
            </div>
        </div>
        
        <div id="inactiveNotice" class="glass p-4 mb-6 hidden">
            <div class="flex items-center">
                <i class="fas fa-user-slash text-red-400 mr-3 text-xl"></i>
                <div>
                    <h4 class="font-semibold text-red-400">Account Deactivated</h4>
                    <p class="text-white/80 text-sm">Your account has been deactivated. Please contact support.</p>
                </div>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
            <div class="glass-card p-6 text-center">
                <i class="fas fa-coins text-4xl text-yellow-400 mb-3"></i>
                <h3 class="text-white/70 text-sm font-medium mb-1">Total Coins</h3>
                <p class="text-3xl font-bold text-white" id="coinCount">0</p>
            </div>
            <div class="glass-card p-6 text-center">
                <i class="fas fa-gem text-4xl text-cyan-400 mb-3"></i>
                <h3 class="text-white/70 text-sm font-medium mb-1">Diamonds</h3>
                <p class="text-3xl font-bold text-cyan-400" id="diamondCount">0</p>
            </div>
            <div class="glass-card p-6 text-center">
                <i class="fas fa-money-bill-wave text-4xl text-green-400 mb-3"></i>
                <h3 class="text-white/70 text-sm font-medium mb-1">Earnings</h3>
                <p class="text-3xl font-bold text-green-400 earning-glow" id="earnings">0.00 BDT</p>
            </div>
            <div class="glass-card p-6 text-center">
                <i class="fas fa-gamepad text-4xl text-purple-400 mb-3"></i>
                <h3 class="text-white/70 text-sm font-medium mb-1">Activities</h3>
                <p class="text-3xl font-bold text-purple-400" id="activitiesCount">0</p>
            </div>
            <div class="glass-card p-6 text-center">
                <i class="fas fa-users text-4xl text-blue-400 mb-3"></i>
                <h3 class="text-white/70 text-sm font-medium mb-1">Referrals</h3>
                <p class="text-3xl font-bold text-blue-400" id="referralCount">0</p>
            </div>
        </div>
        
        <!-- Progress to Next Taka -->
        <div class="glass p-6 mb-8">
            <h3 class="text-white text-lg font-semibold mb-3">
                <i class="fas fa-trophy text-purple-400 mr-2"></i>
                Progress to Next Taka
            </h3>
            <div class="bg-white/20 rounded-full h-4 mb-2">
                <div class="progress-bar h-4 rounded-full" id="progressBar" style="width: 0%"></div>
            </div>
            <p class="text-sm text-white/70" id="progressText">0/1000 coins</p>
        </div>
        
        <!-- Activity Timer -->
        <div id="activityTimer" class="glass p-4 mb-6 hidden border-l-4 border-blue-400">
            <h3 class="text-blue-400 text-lg font-semibold mb-3">
                <i class="fas fa-clock mr-2"></i>
                Activity in Progress
            </h3>
            <div class="bg-white/20 rounded-full h-3 mb-2">
                <div class="timer-progress h-3 rounded-full" id="timerProgress" style="width: 100%"></div>
            </div>
            <p class="text-sm text-white/80" id="timerText">Time remaining: 30 seconds</p>
            <p class="text-xs text-blue-400 mt-2">Stay on page to earn coins!</p>
        </div>
        
        <!-- Action Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button id="gamesBtn" class="earning-btn glass rounded-2xl p-8 text-center hover:bg-white/10 transition-all group">
                <i class="fas fa-gamepad text-5xl mb-4 text-purple-400 group-hover:scale-110 transition-transform"></i>
                <h3 class="text-xl font-bold text-white mb-2">Play Games</h3>
                <p class="text-white/70 text-sm">Earn 10 Coins (30s)</p>
                <p class="text-cyan-400 text-xs mt-1">Cost: 10 💎</p>
            </button>
            <button id="videosBtn" class="earning-btn glass rounded-2xl p-8 text-center hover:bg-white/10 transition-all group">
                <i class="fas fa-video text-5xl mb-4 text-red-400 group-hover:scale-110 transition-transform"></i>
                <h3 class="text-xl font-bold text-white mb-2">Watch Videos</h3>
                <p class="text-white/70 text-sm">Earn 10 Coins (30s)</p>
                <p class="text-cyan-400 text-xs mt-1">Cost: 50 💎</p>
            </button>
            <button id="productsBtn" class="earning-btn glass rounded-2xl p-8 text-center hover:bg-white/10 transition-all group">
                <i class="fas fa-shopping-bag text-5xl mb-4 text-green-400 group-hover:scale-110 transition-transform"></i>
                <h3 class="text-xl font-bold text-white mb-2">View Products</h3>
                <p class="text-white/70 text-sm">Browse Amazing Products</p>
                <p class="text-green-400 text-xs mt-1">Free Browsing</p>
            </button>
        </div>
        
        <!-- User Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="userOnlySection">
            <div class="glass p-6">
                <h3 class="text-white text-lg font-semibold mb-3">
                    <i class="fas fa-share-alt text-blue-400 mr-2"></i>
                    Sharing & Rewards
                </h3>
                <p class="text-sm text-white/70 mb-4">Share to earn diamonds and coins!</p>
                <div class="bg-white/10 p-3 rounded-xl mb-4">
                    <p class="text-xs text-white/60 mb-1">Your Referral Code:</p>
                    <p class="font-mono text-lg font-bold text-white" id="referralCode">LOADING...</p>
                </div>
                <button onclick="shareApp()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-4 rounded-xl hover:from-blue-600 hover:to-purple-700 font-semibold transition-all">
                    <i class="fas fa-share mr-2"></i> Share App (+2💎)
                </button>
            </div>
            <div class="glass p-6">
                <h3 class="text-white text-lg font-semibold mb-3">
                    <i class="fas fa-money-bill-wave text-green-400 mr-2"></i>
                    Withdraw Earnings
                </h3>
                <p class="text-sm text-white/70 mb-4">Minimum withdrawal: 20.00 BDT</p>
                <div class="bg-white/10 p-3 rounded-xl mb-4">
                    <p class="text-xs text-white/60">Available: <span id="withdrawableAmount">0.00 BDT</span></p>
                </div>
                <button onclick="withdrawEarnings()" id="withdrawBtn" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-4 rounded-xl hover:from-green-600 hover:to-teal-700 font-semibold transition-all">
                    <i class="fas fa-whatsapp mr-2"></i> Withdraw via WhatsApp
                </button>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="glass p-6 mb-6">
            <div class="flex items-start">
                <i class="fas fa-lightbulb text-yellow-400 mr-3 mt-1 text-xl"></i>
                <div>
                    <h4 class="font-semibold text-yellow-400 mb-3">How to Earn:</h4>
                    <ul class="text-white/80 text-sm space-y-2 list-disc list-inside">
                        <li>Register with Gmail and verify your email</li>
                        <li>Share the app to earn 2 diamonds per share</li>
                        <li>Use diamonds to unlock daily games (10💎) and videos (50💎)</li>
                        <li>Complete activities for 30 seconds to earn 10 coins each</li>
                        <li>Valid referral codes give 30 bonus coins</li>
                        <li>When someone uses your referral, you get 30 coins</li>
                        <li>Browse products freely without any cost</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="text-center mt-8 text-white/60">
            <p class="text-sm">
                <i class="fas fa-shield-alt mr-2"></i>
                Secure data storage with advanced anti-cheat protection
            </p>
        </div>
    </div>
    
    <!-- Custom Alert Modal -->
    <div class="modal-overlay hidden" id="customAlert">
        <div class="modal-content glass rounded-2xl p-8 text-center">
            <i id="alertIcon" class="fas fa-info-circle text-5xl mb-4 text-blue-400"></i>
            <p id="alertMessage" class="text-xl mb-6 text-white"></p>
            <button onclick="hideCustomAlert()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-xl hover:from-blue-600 hover:to-purple-700 font-semibold transition-all">
                OK
            </button>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal-overlay hidden" id="customConfirm">
        <div class="modal-content glass rounded-2xl p-8 text-center">
            <i class="fas fa-question-circle text-5xl text-yellow-400 mb-4"></i>
            <p id="confirmMessage" class="text-xl mb-6 text-white"></p>
            <div class="flex space-x-4 justify-center">
                <button onclick="hideCustomConfirm(false)" class="px-6 py-3 glass text-white rounded-xl hover:bg-white/20 font-semibold transition-all">
                    Cancel
                </button>
                <button onclick="hideCustomConfirm(true)" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 font-semibold transition-all">
                    Confirm
                </button>
            </div>
        </div>
    </div>
    
    <!-- Email Verification Modal -->
    <div class="modal-overlay hidden" id="emailVerificationModal">
        <div class="modal-content glass rounded-2xl p-8 text-center">
            <i class="fas fa-envelope-circle-check text-6xl text-blue-400 mb-4"></i>
            <h2 class="text-2xl font-bold mb-4 text-white">Verify Your Email</h2>
            <p class="text-white/80 mb-6">A verification code has been sent to your email. Please check and enter the code.</p>
            <div class="space-y-4">
                <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6" class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 text-center text-lg font-mono input-base">
                <div class="flex space-x-3">
                    <button onclick="verifyEmail()" class="flex-1 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-xl hover:from-green-600 hover:to-teal-700 font-semibold transition-all">
                        Verify
                    </button>
                    <button id="resendButton" onclick="resendVerification()" class="flex-1 glass text-white py-3 px-6 rounded-xl hover:bg-white/20 font-semibold transition-all">
                        Resend <span id="resendCountdown"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Main application state
        const appState = {
            currentUser: null,
            isGuestMode: false,
            isAuthenticated: false,
            isEmailVerified: false,
            language: 'en'
        };
        
        // Google Apps Script configuration
        const config = {
            apiEndpoint: 'https://script.google.com/macros/s/AKfycbxwzeoNtCleXecmpyEpfQMiZxNHizvl84nUipSj1FxTySFVhQrT-3K9Oo_7FiidM5HPL/exec',
            whatsappNumber: '8801700000000',
            appVersion: '1.0.0'
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            setupEventListeners();
            checkStoredLogin();
            console.log('Coin Earner Pro - Dashboard initialized');
        }
        
        function setupEventListeners() {
            // Activity buttons
            document.getElementById('gamesBtn').addEventListener('click', () => {
                if (isGuestMode) {
                    startActivity('games', 'https://mustakimridoymr.github.io/Games.html');
                } else {
                    if (!checkActivityPermission('games', 10)) return;
                    startActivity('games', 'https://mustakimridoymr.github.io/Games.html');
                }
            });
            
            document.getElementById('videosBtn').addEventListener('click', () => {
                if (isGuestMode) {
                    startActivity('videos', 'https://mustakimridoymr.github.io/Resources.html');
                } else {
                    if (!checkActivityPermission('videos', 50)) return;
                    startActivity('videos', 'https://mustakimridoymr.github.io/Resources.html');
                }
            });
            
            document.getElementById('productsBtn').addEventListener('click', () => {
                if (isGuestMode) {
                    startActivity('products', 'https://mustakimridoymr.github.io/affiliate.html');
                } else {
                    if (!checkActivityPermission('products', 10)) return;
                    startActivity('products', 'https://mustakimridoymr.github.io/affiliate.html');
                }
            });
            
            // User action buttons
            document.getElementById('withdrawBtn').addEventListener('click', withdrawEarnings);
            document.getElementById('shareApp').addEventListener('click', shareApp);
        }
        
        function checkStoredLogin() {
            const storedUser = localStorage.getItem('coinEarnerUser');
            if (storedUser) {
                try {
                    appState.currentUser = JSON.parse(storedUser);
                    appState.isAuthenticated = true;
                    appState.isGuestMode = false;
                    appState.isEmailVerified = appState.currentUser.isEmailVerified || false;
                    showMainApp();
                } catch (error) {
                    console.error('Error parsing stored user data:', error);
                }
            } else {
                // Show guest content
                showGuestContent();
            }
        }
        
        function showGuestContent() {
            appState.isGuestMode = true;
            appState.isAuthenticated = false;
            document.getElementById('guestNotice').classList.remove('hidden');
            document.getElementById('userOnlySection').style.display = 'none';
            updateDisplay();
        }
        
        function showMainApp() {
            if (!appState.currentUser) return;
            
            // Update UI elements
            document.getElementById('userGreeting').textContent = `Welcome, ${appState.currentUser.name}!`;
            document.getElementById('referralCode').textContent = appState.currentUser.referralCode;
            document.getElementById('currentDiamonds').textContent = appState.currentUser.diamonds;
            
            // Check account status
            if (!appState.currentUser.isEmailVerified) {
                document.getElementById('verificationNotice').classList.remove('hidden');
            }
            
            // Show/hide appropriate sections
            document.getElementById('guestNotice').classList.add('hidden');
            document.getElementById('userOnlySection').style.display = 'grid';
            
            // Update displays
            updateDisplay();
            updateGameButtonStates();
        }
        
        function startActivity(type, url) {
            if (appState.activityInProgress) {
                showCustomAlert('Activity already in progress', 'warning');
                return;
            }
            
            // Reset security state for activity
            securityState.activityMonitoring = true;
            securityState.pageBlurCount = 0;
            securityState.tabSwitches = 0;
            
            appState.activityInProgress = true;
            appState.activityStartTime = Date.now();
            appState.activityEndTime = Date.now() + (30 * 1000);
            appState.activityType = type;
            
            // Disable buttons
            document.querySelectorAll('.earning-btn').forEach(btn => {
                btn.classList.add('disabled');
            });
            
            // Open activity page
            try {
                appState.activityWindow = window.open(url, '_blank');
                
                appState.windowCheckInterval = setInterval(() => {
                    if (appState.activityWindow && appState.activityWindow.closed && appState.activityInProgress) {
                        handleSecurityViolation('window_closed_early');
                    }
                }, 1000);
            } catch (e) {
                console.error('Unable to open activity page:', e);
                resetActivityState();
                showCustomAlert('Failed to open activity page', 'error');
                return;
            }
            
            startActivityTimer();
        }
        
        function startActivityTimer() {
            const duration = 30;
            let timeLeft = duration;
            
            const activityTimer = document.getElementById('activityTimer');
            activityTimer.classList.remove('hidden');
            
            // Clear any existing timer
            if (appState.timer) {
                clearInterval(appState.timer);
                appState.timer = null;
            }
            
            appState.timer = setInterval(() => {
                timeLeft--;
                const progressPercent = (timeLeft / duration) * 100;
                
                document.getElementById('timerProgress').style.width = `${progressPercent}%`;
                
                const t = translations[appState.language];
                document.getElementById('timerText').textContent = `${t.time_remaining} ${timeLeft} ${t.seconds}`;
                
                // Play timer sound every 5 seconds
                if (timeLeft > 0 && timeLeft % 5 === 0) {
                    playSound('timer');
                }
                
                // Security checks
                if (appState.activityWindow && appState.activityWindow.closed) {
                    handleSecurityViolation('window_closed_during_activity');
                    return;
                }
                
                if (securityState.suspiciousActions > 2) {
                    handleSecurityViolation('too_many_violations');
                    return;
                }
                
                if (timeLeft <= 0) {
                    completeActivity();
                }
            }, 1000);
        }
        
        function completeActivity() {
            // Only proceed if we are in an activity
            if (!appState.activityInProgress) {
                return;
            }
            
            const timeSpent = Date.now() - appState.activityStartTime;
            const minTimeRequired = 28000; // 28 seconds
            
            // Clear intervals
            if (appState.timer) {
                clearInterval(appState.timer);
                appState.timer = null;
            }
            if (appState.windowCheckInterval) {
                clearInterval(appState.windowCheckInterval);
                appState.windowCheckInterval = null;
            }
            
            // Capture the result
            const success = timeSpent >= minTimeRequired && securityState.suspiciousActions < 3;
            
            // Reset activity state immediately to prevent re-entrancy
            resetActivityState();
            
            if (success) {
                if (appState.currentUser && !isGuestMode) {
                    addCoins(10);
                    appState.currentUser.activities++;
                    appState.currentUser.lastActivity = new Date().toISOString();
                    saveUserData(appState.currentUser);
                } else if (isGuestMode) {
                    showCustomAlert("Activity completed! Register to earn coins", 'info');
                }
                
                if (appState.activityWindow && !appState.activityWindow.closed) {
                    appState.activityWindow.close();
                }
                
                showCustomAlert(translations[appState.language].activity_completed, 'success');
                playSound('success');
            } else {
                showCustomAlert(translations[appState.language].cheat_detected, 'error');
                playSound('error');
            }
        }
        
        function resetActivityState() {
            if (appState.timer) {
                clearInterval(appState.timer);
                appState.timer = null;
            }
            if (appState.windowCheckInterval) {
                clearInterval(appState.windowCheckInterval);
                appState.windowCheckInterval = null;
            }
            
            appState.activityInProgress = false;
            securityState.activityMonitoring = false;
            appState.activityEndTime = 0;
            appState.activityWindow = null;
            appState.activityType = '';
            
            document.querySelectorAll('.earning-btn').forEach(btn => {
                btn.classList.remove('disabled');
            });
            
            document.getElementById('activityTimer').classList.add('hidden');
        }
        
        function addCoins(amount) {
            if (!appState.currentUser) return;
            
            // Enhanced security: Prevent automatic coin addition
            const now = Date.now();
            if (now - appState.lastCoinAddition < 30000) {
                securityState.coinIncrementAttempts++;
                if (securityState.coinIncrementAttempts > 2) {
                    handleSecurityViolation('coin_cheating_detected');
                    return;
                }
            }
            
            appState.currentUser.coins += amount;
            appState.lastCoinAddition = now;
            
            // Convert coins to earnings
            if (appState.currentUser.coins >= 1000) {
                const newTaka = Math.floor(appState.currentUser.coins / 1000);
                appState.currentUser.earnings += newTaka;
                appState.currentUser.coins = appState.currentUser.coins % 1000;
            }
            
            // Coin animation
            const coinIcon = document.querySelector('.coin-icon');
            if (coinIcon) {
                coinIcon.classList.add('coin-bounce');
                setTimeout(() => coinIcon.classList.remove('coin-bounce'), 600);
            }
            
            // Create floating coins
            for (let i = 0; i < Math.min(amount, 5); i++) {
                setTimeout(() => createFloatingReward('💰', '#fbbf24'), i * 100);
            }
            
            // Play coin sound
            playSound('coin');
            updateDisplay();
        }
        
        function addDiamonds(amount) {
            if (!appState.currentUser) return;
            appState.currentUser.diamonds += amount;
            // Create floating diamonds
            for (let i = 0; i < amount; i++) {
                setTimeout(() => createFloatingReward('💎', '#06b6d4'), i * 100);
            }
            // Play coin sound for diamonds as well
            playSound('coin');
            updateDisplay();
            updateGameButtonStates();
        }
        
        function createFloatingReward(icon, color) {
            const reward = document.createElement('div');
            reward.innerHTML = icon;
            reward.className = 'floating-reward';
            reward.style.color = color;
            reward.style.left = Math.random() * window.innerWidth + 'px';
            reward.style.top = window.innerHeight * 0.8 + 'px';
            document.body.appendChild(reward);
            
            setTimeout(() => {
                if (document.body.contains(reward)) {
                    document.body.removeChild(reward);
                }
            }, 2000);
        }
        
        function logout() {
            if (appState.activityInProgress) {
                handleSecurityViolation('logout_during_activity');
            }
            
            appState.currentUser = null;
            appState.isAuthenticated = false;
            appState.isGuestMode = false;
            
            // Clear stored login
            localStorage.removeItem('coinEarnerUser');
            
            // Redirect to login
            window.location.href = 'index.html';
        }
        
        function shareApp() {
            if (isGuestMode) {
                // Allow guest sharing but no rewards
                const shareText = appState.language === 'en' ? 
                    `Coin Earner Pro - Earn Money Playing Games!\n` +
                    `Share this app and start earning today!\n` +
                    window.location.href :
                    `কয়েন আর্নার প্রো - গেম খেলে টাকা জিতুন!\n` +
                    `এই অ্যাপটি শেয়ার করুন এবং আজই উপার্জন শুরু করুন!\n` +
                    window.location.href;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Coin Earner Pro',
                        text: shareText
                    });
                } else {
                    copyToClipboard(shareText);
                }
                return;
            }
            
            if (!appState.currentUser || !appState.currentUser.isEmailVerified) {
                showCustomAlert(translations[appState.language].guest_earning_disabled, 'warning');
                playSound('warning');
                return;
            }
            
            const shareText = appState.language === 'en' ? 
                `Join Coin Earner Pro! My referral code: ${appState.currentUser.referralCode}\n` +
                `Earn money playing games!\n` +
                window.location.href + `?ref=${appState.currentUser.referralCode}` :
                `কয়েন আর্নার প্রোতে যোগ দিন! আমার রেফারেল কোড: ${appState.currentUser.referralCode}\n` +
                `গেম খেলে টাকা জিতুন!\n` +
                window.location.href + `?ref=${appState.currentUser.referralCode}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Coin Earner Pro',
                    text: shareText
                }).then(() => {
                    awardShareBonus();
                }).catch(() => {
                    copyToClipboard(shareText);
                    awardShareBonus();
                });
            } else {
                copyToClipboard(shareText);
                awardShareBonus();
            }
        }
        
        function awardShareBonus() {
            addDiamonds(2);
            appState.currentUser.lastActivity = new Date().toISOString();
            saveUserData(appState.currentUser);
            showCustomAlert(translations[appState.language].share_earned, 'success');
            playSound('success');
        }
        
        function withdrawEarnings() {
            if (isGuestMode || !appState.currentUser) {
                showCustomAlert(translations[appState.language].guest_earning_disabled, 'warning');
                playSound('warning');
                return;
            }
            if (appState.currentUser.earnings < 20) {
                showCustomAlert(translations[appState.language].insufficient_balance, 'warning');
                playSound('warning');
                return;
            }
            
            const t = translations[appState.language];
            const message = t.withdraw_confirm.replace('{amount}', formatCurrency(appState.currentUser.earnings));
            
            showCustomConfirm(message, (confirmed) => {
                if (confirmed) {
                    const whatsappMessage = `Withdraw: ${formatCurrency(appState.currentUser.earnings)}\nName: ${appState.currentUser.name}\nEmail: ${appState.currentUser.email}\nMobile: ${appState.currentUser.mobile}\nAddress: ${appState.currentUser.address || 'Not provided'}\nReferral Code: ${appState.currentUser.referralCode}\nTotal Activities: ${appState.currentUser.activities}`;
                    const whatsappUrl = `https://wa.me/${config.whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;
                    
                    window.open(whatsappUrl, '_blank');
                    
                    // Reset user data after withdrawal
                    appState.currentUser.coins = 0;
                    appState.currentUser.diamonds = 0;
                    appState.currentUser.earnings = 0;
                    appState.currentUser.activities = 0;
                    appState.currentUser.dailyUnlockedGames = false;
                    appState.currentUser.dailyUnlockedVideos = false;
                    appState.currentUser.lastActivity = new Date().toISOString();
                    saveUserData(appState.currentUser);
                    
                    updateDisplay();
                    updateGameButtonStates();
                    
                    showCustomAlert(t.withdraw_success, 'success');
                    playSound('success');
                }
            });
        }
        
        function updateDisplay() {
            const elements = {
                coinCount: document.getElementById('coinCount'),
                diamondCount: document.getElementById('diamondCount'),
                earnings: document.getElementById('earnings'),
                activitiesCount: document.getElementById('activitiesCount'),
                referralCount: document.getElementById('referralCount'),
                progressBar: document.getElementById('progressBar'),
                progressText: document.getElementById('progressText'),
                withdrawableAmount: document.getElementById('withdrawableAmount'),
                currentDiamonds: document.getElementById('currentDiamonds')
            };
            
            if (appState.currentUser) {
                elements.coinCount.textContent = formatNumber(appState.currentUser.coins);
                elements.diamondCount.textContent = formatNumber(appState.currentUser.diamonds);
                elements.earnings.textContent = formatCurrency(appState.currentUser.earnings);
                elements.activitiesCount.textContent = formatNumber(appState.currentUser.activities);
                elements.referralCount.textContent = formatNumber(appState.currentUser.referrals);
                const coinsToNextTaka = appState.currentUser.coins % 1000;
                const progressPercent = (coinsToNextTaka / 1000) * 100;
                elements.progressBar.style.width = `${progressPercent}%`;
                elements.progressText.textContent = `${coinsToNextTaka}/1000 coins`;
                elements.withdrawableAmount.textContent = formatCurrency(appState.currentUser.earnings);
                if (elements.currentDiamonds) {
                    elements.currentDiamonds.textContent = appState.currentUser.diamonds;
                }
            } else {
                // Guest mode - show zeros
                Object.values(elements).forEach(el => {
                    if (el && (el.id === 'earnings' || el.id === 'withdrawableAmount')) {
                        el.textContent = formatCurrency(0);
                    } else if (el && el.id === 'progressText') {
                        el.textContent = '0/1000 coins';
                    } else if (el) {
                        el.textContent = '0';
                    }
                });
            }
        }
        
        function updateGameButtonStates() {
            const gamesBtn = document.getElementById('gamesBtn');
            const videosBtn = document.getElementById('videosBtn');
            const unlockNotice = document.getElementById('unlockNotice');
            
            if (!appState.currentUser || !appState.currentUser.isEmailVerified) {
                unlockNotice.classList.add('hidden');
                gamesBtn.classList.remove('button-locked');
                videosBtn.classList.remove('button-locked');
                return;
            }
            
            const today = new Date().toDateString();
            
            if (appState.currentUser.lastUnlockDate !== today) {
                appState.currentUser.dailyUnlockedGames = false;
                appState.currentUser.dailyUnlockedVideos = false;
                appState.currentUser.lastUnlockDate = today;
            }
            
            const needsGameUnlock = !appState.currentUser.dailyUnlockedGames;
            const needsVideoUnlock = !appState.currentUser.dailyUnlockedVideos;
            const hasGameDiamonds = appState.currentUser.diamonds >= 10;
            const hasVideoDiamonds = appState.currentUser.diamonds >= 50;
            
            if ((needsGameUnlock && !hasGameDiamonds) || (needsVideoUnlock && !hasVideoDiamonds)) {
                unlockNotice.classList.remove('hidden');
            } else {
                unlockNotice.classList.add('hidden');
            }
            
            if (needsGameUnlock && !hasGameDiamonds) {
                gamesBtn.classList.add('button-locked');
            } else {
                gamesBtn.classList.remove('button-locked');
            }
            
            if (needsVideoUnlock && !hasVideoDiamonds) {
                videosBtn.classList.add('button-locked');
            } else {
                videosBtn.classList.remove('button-locked');
            }
        }
        
        function formatCurrency(amount) {
            const bdtAmount = amount.toFixed(2);
            return appState.language === 'en' ? `${bdtAmount} BDT` : `${bdtAmount} টাকা`;
        }
        
        function formatNumber(num) {
            return appState.language === 'en' ? num.toString() : num.toLocaleString('bn-BD');
        }
        
        function checkActivityPermission(activityType, diamondCost) {
            if (isGuestMode || !appState.currentUser || !appState.currentUser.isEmailVerified) {
                showCustomAlert(translations[appState.language].guest_earning_disabled, 'warning');
                playSound('warning');
                return false;
            }
            if (!appState.currentUser.isActive) {
                showCustomAlert(translations[appState.language].account_inactive, 'error');
                playSound('error');
                return false;
            }
            const today = new Date().toDateString();
            
            if (appState.currentUser.lastUnlockDate !== today) {
                appState.currentUser.dailyUnlockedGames = false;
                appState.currentUser.dailyUnlockedVideos = false;
                appState.currentUser.lastUnlockDate = today;
            }
            
            // Check if already unlocked today
            if (activityType === 'games' && !appState.currentUser.dailyUnlockedGames) {
                if (appState.currentUser.diamonds >= diamondCost) {
                    appState.currentUser.diamonds -= diamondCost;
                    appState.currentUser.dailyUnlockedGames = true;
                    saveUserData(appState.currentUser);
                    updateDisplay();
                    updateGameButtonStates();
                    
                    const message = translations[appState.language].daily_unlocked_games;
                    showCustomAlert(message, 'success');
                    playSound('success');
                } else {
                    const message = translations[appState.language].insufficient_diamonds_games;
                    showCustomAlert(message, 'warning');
                    playSound('warning');
                }
                return true;
            }
            
            if (activityType === 'videos' && !appState.currentUser.dailyUnlockedVideos) {
                if (appState.currentUser.diamonds >= diamondCost) {
                    appState.currentUser.diamonds -= diamondCost;
                    appState.currentUser.dailyUnlockedVideos = true;
                    saveUserData(appState.currentUser);
                    updateDisplay();
                    updateGameButtonStates();
                    
                    const message = translations[appState.language].daily_unlocked_videos;
                    showCustomAlert(message, 'success');
                    playSound('success');
                } else {
                    const message = translations[appState.language].insufficient_diamonds_videos;
                    showCustomAlert(message, 'warning');
                    playSound('warning');
                }
                return true;
            }
            
            return true;
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            }
        }
        
        // Modal functions
        function showCustomAlert(message, type = 'info') {
            const alertIcon = document.getElementById('alertIcon');
            const alertMessage = document.getElementById('alertMessage');
            const customAlert = document.getElementById('customAlert');
            
            switch(type) {
                case 'success':
                    alertIcon.className = 'fas fa-check-circle text-5xl mb-4 text-green-400';
                    playSound('success');
                    break;
                case 'error':
                    alertIcon.className = 'fas fa-exclamation-circle text-5xl mb-4 text-red-400';
                    playSound('error');
                    break;
                case 'warning':
                    alertIcon.className = 'fas fa-exclamation-triangle text-5xl mb-4 text-yellow-400';
                    playSound('warning');
                    break;
                default:
                    alertIcon.className = 'fas fa-info-circle text-5xl mb-4 text-blue-400';
                    playSound('info');
            }
            
            alertMessage.textContent = message;
            customAlert.classList.add('show');
            
            setTimeout(() => {
                customAlert.classList.remove('show');
            }, 3000);
        }
        
        function hideCustomAlert() {
            document.getElementById('customAlert').classList.remove('show');
        }
        
        function showCustomConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('customConfirm').classList.add('show');
            
            // Store callback for later use
            window.confirmCallback = callback;
        }
        
        function hideCustomConfirm(result) {
            document.getElementById('customConfirm').classList.remove('show');
            
            // Execute callback if available
            if (window.confirmCallback) {
                window.confirmCallback(result);
                window.confirmCallback = null;
            }
        }
        
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showCustomAlert('Link copied to clipboard!', 'success');
                    playSound('success');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCustomAlert('Link copied to clipboard!', 'success');
                playSound('success');
            }
        }
        
        function playSound(type) {
            try {
                const sound = document.getElementById(`${type}Sound`);
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log('Sound play failed:', e));
                }
            } catch (error) {
                console.error('Error playing sound:', error);
            }
        }
        
        // Google Apps Script functions
        async function saveUserData(user) {
            try {
                const formData = new FormData();
                formData.append('action', 'saveUser');
                formData.append('userData', JSON.stringify(user));
                
                const response = await fetch(config.apiEndpoint, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.text();
                console.log('Save user response:', result);
                
                if (result.includes('error')) {
                    throw new Error(result);
                }
                
                return true;
            } catch (error) {
                console.error('Error saving user data:', error);
                throw error;
            }
        }
        
        // Additional utility functions
        function generateReferralCode() {
            return 'REF' + Math.random().toString(36).substr(2, 6).toUpperCase() + Date.now().toString().slice(-3);
        }
        
        // Global functions for onclick handlers
        window.logout = logout;
        window.shareApp = shareApp;
        window.withdrawEarnings = withdrawEarnings;
        window.toggleTheme = toggleTheme;
        window.hideCustomAlert = hideCustomAlert;
        window.hideCustomConfirm = hideCustomConfirm;
        
        // Initialize theme
        loadTheme();
        
        // Start activity monitoring
        setInterval(() => {
            if (appState.activityInProgress) {
                const timeSpent = Date.now() - appState.activityStartTime;
                if (timeSpent > 30000) { // 30 seconds timeout
                    resetActivityState();
                    showCustomAlert('Activity timed out', 'warning');
                }
            }
        }, 5000);
    </script>
</body>
</html>
